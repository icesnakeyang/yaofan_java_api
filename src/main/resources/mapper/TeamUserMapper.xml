<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gogoyang.yaofan.meta.team.dao.TeamUserDao">
    <resultMap id="teamUserMap" type="com.gogoyang.yaofan.meta.team.entity.TeamUser">
        <result property="userId" column="user_id"/>
        <result property="teamId" column="team_id"/>
        <result property="teamName" column="team_name"/>
        <result property="userName" column="my_name"/>
        <result property="managerName" column="manager_name"/>
        <result property="creatorName" column="creator_name"/>
        <result property="status" column="status"/>
    </resultMap>

    <!--创建一个新的团队用户链接-->
    <insert id="createTeamUser"
            parameterType="com.gogoyang.yaofan.meta.team.entity.TeamUser">
        insert into team_user
        (user_id, team_id, status, create_time)
        values
        (#{userId}, #{teamId}, #{status}, #{createTime})
    </insert>

    <!--查询团队成员列表-->
    <select id="listTeamUser" parameterType="map" resultMap="teamUserMap">
        select
            team_user.ids,
            team_user.user_id,
            team_user.team_id,
            team.name as team_name,
            me.name as my_name,
            manager.name as manager_name,
            creator.name as creator_name,
            team_user.status,
        description
            from (((team_user
            inner join team on team_user.team_id = team.team_id)
            inner join user_info me on team_user.user_id = me.user_id)
            inner join user_info manager on team.manager_id = manager.user_id)
            inner join user_info creator on team.create_user_id = creator.user_id
        where 1=1
            <choose>
                <when test="status!=null">
                    and team_user.status=#{status}
                </when>
            </choose>
            <choose>
                <when test="userId!=null">
                    and team_user.user_id=#{userId}
                </when>
            </choose>
            <choose>
                <when test="teamId!=null">
                    and team_user.team_id=#{teamId}
                </when>
            </choose>
    </select>
</mapper>